"use strict";
/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
* Copyright 2022 Adobe
* All Rights Reserved.
*
* NOTICE: All information contained herein is, and remains
* the property of Adobe and its suppliers, if any. The intellectual
* and technical concepts contained herein are proprietary to Adobe
* and its suppliers and are protected by all applicable intellectual
* property laws, including trade secret and copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe.

* Adobe permits you to use and modify this file solely in accordance with
* the terms of the Adobe license agreement accompanying it.
*************************************************************************/
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const react_spectrum_1 = require("@adobe/react-spectrum");
const react_1 = __importStar(require("react"));
const af_react_renderer_1 = require("@aemforms/af-react-renderer");
const af_core_1 = require("@aemforms/af-core");
const af_react_renderer_2 = require("@aemforms/af-react-renderer");
const TabWrapper = function (props) {
    const { mappings, form } = (0, react_1.useContext)(af_react_renderer_1.FormContext);
    //@ts-ignore
    const { items, label, id, visible, orientation, activeChild } = props;
    const { v: visibleItems, d: disabledIds, a: activeItem } = items.reduce(({ v, d, a }, item) => {
        const isVisible = item.visible === true;
        const isEnabled = item.enabled === true;
        return {
            v: isVisible ? v.concat([item]) : v,
            //@ts-ignore
            d: !isEnabled ? d.concat([item.id]) : d,
            a: a === null && (isVisible && isEnabled) ? item : a
        };
    }, { v: [], d: [], a: null });
    //const visibleItems = items.filter(i => i.visible);
    const layout = props?.properties?.['afs:layout'] || {};
    // @ts-ignore
    //const disabledItems = items.filter(i => i.enabled === false).map(i => i.id);
    //const firstActiveItem =
    //@ts-ignore
    const activeElementId = activeChild || activeItem?.id;
    const getTabPanels = (0, react_1.useCallback)(() => {
        return (visibleItems.map((child, index) => {
            const Comp = (0, af_react_renderer_2.getRenderer)(child, mappings);
            return (react_1.default.createElement(react_spectrum_1.Item, { key: child?.id },
                react_1.default.createElement(Comp, { key: `${child.id}_${index}`, ...child })));
        }));
    }, [visibleItems, mappings]);
    const localizeTabLabel = (0, react_1.useCallback)((item) => {
        let defaultMessage = item?.label?.value;
        const id = (0, af_core_1.getOrElse)(item, [af_core_1.CUSTOM_PROPS_KEY, af_core_1.TRANSLATION_ID, 'label.value']);
        if (id) {
            const i18n = (0, af_react_renderer_2.useFormIntl)();
            defaultMessage = i18n.formatMessage({ id, defaultMessage });
        }
        return defaultMessage;
    }, [af_react_renderer_2.useFormIntl]);
    const setTab = (id) => {
        const element = form.getElement(id);
        if (element.enabled === true) {
            //@ts-ignore
            form.setFocus(form.getElement(id));
        }
    };
    return visible ? (react_1.default.createElement(react_spectrum_1.Flex, { gap: "size-150", wrap: true },
        label && label.value && label.visible !== false ? react_1.default.createElement("span", { id: id }, label.value) : '',
        (visibleItems.length > 0 ?
            (react_1.default.createElement(react_spectrum_1.Tabs, { ...layout, selectedKey: activeElementId, disabledKeys: disabledIds, "aria-labelledby": id, onSelectionChange: setTab, orientation: orientation },
                react_1.default.createElement(react_spectrum_1.TabList, null, visibleItems.map((item) => (react_1.default.createElement(react_spectrum_1.Item, { key: item?.id }, localizeTabLabel(item))))),
                react_1.default.createElement(react_spectrum_1.TabPanels, null, getTabPanels()))) : null))) : null;
};
exports.default = TabWrapper;
